---
title: "Our first plot"
teaching: 10
exercises: 5
questions:
- "FIX ME"
objectives:
- "FIX ME"
keypoints:
- "FIX ME"

source: Rmd
---

```{r, include = FALSE}
source("../bin/chunk-options.R")
knitr_fig_path("015-")
library(tidyverse)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

We saw how to map data to a position in a scatterplot. But we are able to map 
the data to other elements of a plot, eg the color of the points.


```{r}
ggplot(data = diamonds, mapping = aes(x = carat, y = price, color = color)) +
  geom_point()
```
Not surprisingly, the "best" color, D have higher prices than the "worst"
color, "J".

A common mistake is to place the color argument a wrong place:
```{r}
ggplot(data = diamonds, mapping = aes(x = carat, y = price), color = color) +
  geom_point()
```
What happened to the color? The color argument is outside the aes() function.
That means that we are not mapping data to the color!

What else can we map data to?

```{r}
ggplot(data = diamonds, mapping = aes(x = carat, y = price, color = color, size = table)) +
  geom_point()
```

What can be mapped to the plot depends on the geom we are using. 

Calling the help function, ?geom_point, on a geom will provide insight on that
question. Doing it on the geom_poin() function, reveals that x and y are mandatory
because they are in bold.


## not actually mapping
Rather than mapping values from the data to an aesthetic, we can provide
values directly. One very useful aesthetic to play with, at least when
we have as many datapoints as we have here, is `alpha`:

```{r}
ggplot(data = diamonds, mapping = aes(x = carat, y = price, color = color)) +
  geom_point(alpha = 0.1)
```
`alpha´ controls the transparency of the points plotted, and is a handy way of
handling overplotting, the phenomenon that multiple data points might be 
identical. 




The coordinate system can be changed. If we want to flip the coordinates, we
could interchange the x and y values in the mapping argument.
Or we could add a coordinate function that changes the coordinate system:

```{r}
ggplot(data = diamonds, mapping = aes(x = carat, y = price, color = color)) +
  geom_point() +
  coord_flip()
```
Other coord_ functions exists, the most commonly used are coord_flip and coord_polar:
```{r}
ggplot(data = diamonds, mapping = aes(x = carat, y = price, color = color)) +
  geom_point() +
  coord_polar()
```
That might not be that useful working with diamonds.


### SCALE_FUNCTION



### THEME_FUNCTION



The structure of plots generated by ggplot2 allows us to change plot type from eg. barplot to scatterplots with only minimal changes. 

og hvis vi ændrer på det underliggende data.

ggplot2 is the package. The funcion is called ggplot(). 

https://pkg.garrickadenbuie.com/gentle-ggplot2/#153

ggplot2 works best with data in a socalled long format, ie one column for 
each (and every) variable, and a row for every observation.

It is highly recommended to structure data in this way.

How are visuals expressed in words?

Data - to be visualised

Geometric objects that appear on the plot

Aesthetic mappings from data to component in graph

Statistics - transforming data on its way to the graph

Coordinates - that organises the location of geometric objects

Scales - defining the range of values for aesthetics

Facets - grouping data into subplots.



Data:
ggplot(data)

Tidy data:
Each variable forms a column

Each observation forms a row

Each observational unit forms a table


Begin by asking:

What information do I want to use in my 
visualisation

Is that data contained in one column/row
for a given data point?

Måske et eksempel.

Aesthetics + aes()

Vis hvad der mappes til hvad i et gennemgående eksempel. 
year -> x
pop -> y
country -> farve, form noget

videre til:
aes(x = year,
    y = pop,
    color = country)
    
    
+ geom_*() - der er et fint plot #36

Denn figur taget ret direkte. Det er heller
ikke givet at det er den jeg er har lyst til at vise.

```{r geom_demo, echo=FALSE, fig.width=6, out.width="650px"}
minimal_theme <- theme_bw() +
  theme(
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    panel.grid = element_blank(),
    panel.border = element_blank(),
    axis.title = element_blank(),
    plot.title = element_text(hjust = 0.5),
    text = element_text(family = "Fira Mono"),
    plot.background = element_rect(fill = "#FAFAFA", color = NA),
    panel.background = element_rect(fill = "#FAFAFA", color = NA)
  )
set.seed(4242)
df_geom <- data_frame(y = rnorm(10), x = 1:10)
g_geom <- list()
g_geom$point <- ggplot(df_geom, aes(x, y)) + geom_point() + ggtitle("geom_point()")
g_geom$line <- ggplot(df_geom, aes(x, y)) + geom_line() + ggtitle("geom_line()")
g_geom$bar <- ggplot(df_geom, aes(x, y)) + geom_col() + ggtitle("geom_col()")
g_geom$boxplot <- ggplot(df_geom, aes(y = y)) + geom_boxplot() + ggtitle("geom_boxplot()")
g_geom$histogram <- ggplot(df_geom, aes(y)) + geom_histogram(binwidth = 1) + ggtitle("geom_histogram()")
g_geom$density <- ggplot(df_geom, aes(y)) + geom_density(fill = "grey40", alpha = 0.25) + ggtitle("geom_density()") + xlim(-4, 4)
g_geom <- map(g_geom, ~ . + minimal_theme)
cowplot::plot_grid(plotlist = g_geom)
```


Jeg ved ikke hvordan 
det her kommer itl at se ud rendret, men:
| Type | Function |
|:----:|:--------:|
| Point | `geom_point()` |
| Line | `geom_line()` |
| Bar | `geom_bar()`, `geom_col()` |
| Histogram | `geom_histogram()` |
| Regression | `geom_smooth()` |
| Boxplot | `geom_boxplot()` |
| Text | `geom_text()` |
| Vert./Horiz. Line | `geom_{vh}line()` |
| Count | `geom_count()` |
| Density | `geom_density()` |



Og mange flerE:
```{r}
lsf.str("package:ggplot2") %>% grep("^geom_", ., value = TRUE)

```

Og så skal vi måske nappe et plot, som vi stille og roligt tilføjer ting til.

det er indtil #65 i kilden. Og så er vi 
dels ved at være der, dels til at dykke
ned i resten af dem.

EKSEMPEL PÅ STRUKTUREN

The simplest ggplot follows this structure:

ggplot(data = <DATA>, mapping = aes(<MAPPINGS>)) +  <GEOM_FUNCTION>()

We begin by binding a specific data frame to our plot:
```{r eval =F}
ggplot(data = diamonds)
```

Then we define an aesthetic mapping of the data, to elements in the plot. We use the helper function aes() for this:

```{r eval=F}
ggplot(data = diamonds, mapping = aes(x = carat, y = price))
```

Here we map the weight of the diamonds to the x-axis, and the price to the y-axis. We can map other variables to other elements of the plot, size, shape or color to mention the three most popular.

This in it self does not return a very interesting plot:
```{r}
ggplot(data = diamonds, mapping = aes(x = carat, y = price))
```

We do get the two scales scaled to the ranges of data we have on the x and y axes.

```{r}
range(diamonds$carat)
```
```{r}
range(diamonds$price)
```
But we have not specified how we want the data plotted.

We add "geoms", the graphical representation of the data in the plot. ggplot2 have a lot of geoms to choose from. We are beginning with these:

- geom_point() makes scatter plots, dot plots etc
- geom_boxplot() makes boxplots
- geom_line() for trendlines, etc

The general naming is relatively intuitive. If geom_histogram makes histograms to take just one example.

Let us make a scatter plot:
```{r}
ggplot(data = diamonds, mapping = aes(x = carat, y = price)) +
  geom_point()
```

Note that we add geoms to our original (boring) plot by using the + operator.

CHALLENGE

Try to plot the price as a function of the table variable, instead of the carat:

SOLUTION
```{r}
ggplot(diamonds, aes(x, price)) + geom_point()
```

The + operator is rather useful, because it allows us to modify existing plots. We can save the very first plot we made in a variable:
```{r}
diamond_plot <- ggplot(data = diamonds, mapping = aes(x = carat, y = price))
```

And then make the scatter plot by adding the relevant geom to it:

```{r}
diamond_plot + geom_point()
```
Anything you put in the ggplot() function can be seen by any geom layers that you add (i.e., these are universal plot settings). This includes the x- and y-axis you set up in aes().
You can also specify aesthetics for a given geom independently of the aesthetics defined globally in the ggplot() function.
The + sign used to add layers must be placed at the end of each line containing a layer. If, instead, the + sign is added in the line before the other layer, ggplot2 will not add the new layer and will return an error message.
You may notice that we sometimes reference ‘ggplot2’ and sometimes ‘ggplot’. To clarify, ‘ggplot2’ is the name of the most recent version of the package. However, any time we call the function itself, it’s just called ‘ggplot’.


# This is the correct syntax for adding layers
surveys_plot +
  geom_point()

# This will not add the new layer and will return an error message
surveys_plot
  + geom_point()


saving plottet.

{% include links.md %}