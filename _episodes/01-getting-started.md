---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 01-getting-started.md in _episodes_rmd/
title: "Plotting with ggplot2"
teaching: 10
exercises: 5
questions:
- "FIX ME"
objectives:
- "FIX ME"
keypoints:
- "FIX ME"

source: Rmd
---





## The grammar of graphics

Plotting using ggplot2 is based on "The Grammar of Graphics" 
https://link.springer.com/book/10.1007/0-387-28695-0, a theoretical treatment of how 
to talk about and conceptualize plots by Leland Wilkinson.

We do not need to know or understand all details of this 620 page book. But some
weird naming conventions follows from this.

What we do need to know, is that based on the grammar of graphics, the layered
structure of a plot using ggplot, is build like this:

ggplot(data = <DATA>) +
<GEOM_FUNCTION>(mapping = aes(<MAPPINGS>),
stat = <STAT>, position = <POSITION>) +
COORDINATE_FUNCTION +
FACET_FUNCTION +
SCALE_FUNCTION +
THEME_FUNCTION.


We are going to cover each element in the following.

## ggplot in it self

The first thing we need to provide for ggplot is some data. We are working with
the diamond dataset:

~~~
ggplot(data = diamonds)
~~~
{: .language-r}



~~~
Error in ggplot(data = diamonds): could not find function "ggplot"
~~~
{: .error}
This in itself produces an extremely boring plot. But it is a plot!. What is 
missing is information on what exactly it is in the dataset we are trying to plot.
How should our data be *mapped* to the area of our plot? Or, what should we 
have on the X-axis, and what should be on the Y-axis?

We provide that information to ggplot using the *mapping* argument to the 
ggplot function:

~~~
ggplot(data = diamonds, mapping = aes(x = carat, y = price))
~~~
{: .language-r}



~~~
Error in ggplot(data = diamonds, mapping = aes(x = carat, y = price)): could not find function "ggplot"
~~~
{: .error}

This specifies that we want the carat-value on the x-axis, and the value, price, 
of the diamond on the y-axis. 

We are not actually seeing any data, because we have not specified the way the
individual datapoints should be plotted. 

We are going to use points, in order to make a classic scatter plot. We do that
by adding a geom_ function to our plot:

~~~
ggplot(data = diamonds, mapping = aes(x = carat, y = price)) +
  geom_point()
~~~
{: .language-r}



~~~
Error in ggplot(data = diamonds, mapping = aes(x = carat, y = price)): could not find function "ggplot"
~~~
{: .error}
Note that in the template shown above, mapping was placed in the <GEOM_FUNCTION>
rather than in the ggplot function. If we place the mapping in the ggplot function
that mapping will be inherited by the functions we add later, unless we specify
something different.

That means that:

~~~
ggplot(data = diamonds, mapping = aes(x = carat, y = price)) +
  geom_point()
~~~
{: .language-r}

and

~~~
ggplot(data = diamonds) +
  geom_point(mapping = aes(x = carat, y = price))
~~~
{: .language-r}

will yield the same result.

We might want to colour the points in the plot. And we might want to colour them
differently, based on some value, eg the color.

That means, that we now want to map the color of a particular diamond, to a colour
in our plot. And therefore, we need to add a colour argument to our 
mapping:

~~~
ggplot(data = diamonds, mapping = aes(x = carat, y = price, color = color)) +
  geom_point()
~~~
{: .language-r}



~~~
Error in ggplot(data = diamonds, mapping = aes(x = carat, y = price, color = color)): could not find function "ggplot"
~~~
{: .error}
Not surprisingly, the "best" color, D have higher prices than the "worst"
color, "J".

There are a lot of diamonds. So the individual points we see, might actually
be a lot of different points lying on top of each other. If we add an argument
"alpha" to the geom_point function, we can adjust how the points are plotted,
in this case the transparency of the points.


~~~
ggplot(data = diamonds, mapping = aes(x = carat, y = price, color = color)) +
  geom_point(alpha = 0.1)
~~~
{: .language-r}



~~~
Error in ggplot(data = diamonds, mapping = aes(x = carat, y = price, color = color)): could not find function "ggplot"
~~~
{: .error}
Similarly we can control the size and shape of the points, by providing the 
arguments *size* and *shape* to the geom_point function respectively.

The coordinate system can be changed. If we want to flip the coordinates, we
could interchange the x and y values in the mapping argument.
Or we could add a coordinate function that changes the coordinate system:


~~~
ggplot(data = diamonds, mapping = aes(x = carat, y = price, color = color)) +
  geom_point() +
  coord_flip()
~~~
{: .language-r}



~~~
Error in ggplot(data = diamonds, mapping = aes(x = carat, y = price, color = color)): could not find function "ggplot"
~~~
{: .error}
Other coord_ functions exists, the most commonly used are coord_flip and coord_polar:

~~~
ggplot(data = diamonds, mapping = aes(x = carat, y = price, color = color)) +
  geom_point() +
  coord_polar()
~~~
{: .language-r}



~~~
Error in ggplot(data = diamonds, mapping = aes(x = carat, y = price, color = color)): could not find function "ggplot"
~~~
{: .error}
That might not be that useful working with diamonds.

### FACET_FUNCTION

There are more variables in this dataset. But it becomes increasingly difficult
to add information to a two dimensional plot. One way to overcome this might be to 
make more than one plot, based on values in the dataset.

This is called facetting:


~~~
ggplot(data = diamonds, mapping = aes(x = carat, y = price, color = color)) +
  geom_point() +
  facet_wrap(~clarity)
~~~
{: .language-r}



~~~
Error in ggplot(data = diamonds, mapping = aes(x = carat, y = price, color = color)): could not find function "ggplot"
~~~
{: .error}

~~~
ggplot(data = diamonds, mapping = aes(x = carat, y = price, color = color)) +
  geom_point() +
  facet_grid(clarity ~color)
~~~
{: .language-r}



~~~
Error in ggplot(data = diamonds, mapping = aes(x = carat, y = price, color = color)): could not find function "ggplot"
~~~
{: .error}

### SCALE_FUNCTION



### THEME_FUNCTION



The structure of plots generated by ggplot2 allows us to change plot type from eg. barplot to scatterplots with only minimal changes. 

og hvis vi ændrer på det underliggende data.

ggplot2 is the package. The funcion is called ggplot(). 

https://pkg.garrickadenbuie.com/gentle-ggplot2/#153

ggplot2 works best with data in a socalled long format, ie one column for 
each (and every) variable, and a row for every observation.

It is highly recommended to structure data in this way.

How are visuals expressed in words?

Data - to be visualised

Geometric objects that appear on the plot

Aesthetic mappings from data to component in graph

Statistics - transforming data on its way to the graph

Coordinates - that organises the location of geometric objects

Scales - defining the range of values for aesthetics

Facets - grouping data into subplots.



Data:
ggplot(data)

Tidy data:
Each variable forms a column

Each observation forms a row

Each observational unit forms a table


Begin by asking:

What information do I want to use in my 
visualisation

Is that data contained in one column/row
for a given data point?

Måske et eksempel.

Aesthetics + aes()

Vis hvad der mappes til hvad i et gennemgående eksempel. 
year -> x
pop -> y
country -> farve, form noget

videre til:
aes(x = year,
    y = pop,
    color = country)
    
    
+ geom_*() - der er et fint plot #36

Denn figur taget ret direkte. Det er heller
ikke givet at det er den jeg er har lyst til at vise.


~~~
Error in theme_bw(): could not find function "theme_bw"
~~~
{: .error}



~~~
Error in data_frame(y = rnorm(10), x = 1:10): could not find function "data_frame"
~~~
{: .error}



~~~
Error in ggplot(df_geom, aes(x, y)): could not find function "ggplot"
~~~
{: .error}



~~~
Error in ggplot(df_geom, aes(x, y)): could not find function "ggplot"
~~~
{: .error}



~~~
Error in ggplot(df_geom, aes(x, y)): could not find function "ggplot"
~~~
{: .error}



~~~
Error in ggplot(df_geom, aes(y = y)): could not find function "ggplot"
~~~
{: .error}



~~~
Error in ggplot(df_geom, aes(y)): could not find function "ggplot"
~~~
{: .error}



~~~
Error in ggplot(df_geom, aes(y)): could not find function "ggplot"
~~~
{: .error}



~~~
Error in map(g_geom, ~. + minimal_theme): could not find function "map"
~~~
{: .error}



~~~
Error in grobs[[i]]: subscript out of bounds
~~~
{: .error}


Jeg ved ikke hvordan 
det her kommer itl at se ud rendret, men:
| Type | Function |
|:----:|:--------:|
| Point | `geom_point()` |
| Line | `geom_line()` |
| Bar | `geom_bar()`, `geom_col()` |
| Histogram | `geom_histogram()` |
| Regression | `geom_smooth()` |
| Boxplot | `geom_boxplot()` |
| Text | `geom_text()` |
| Vert./Horiz. Line | `geom_{vh}line()` |
| Count | `geom_count()` |
| Density | `geom_density()` |



Og mange flerE:

~~~
lsf.str("package:ggplot2") %>% grep("^geom_", ., value = TRUE)
~~~
{: .language-r}



~~~
Error in lsf.str("package:ggplot2") %>% grep("^geom_", ., value = TRUE): could not find function "%>%"
~~~
{: .error}

Og så skal vi måske nappe et plot, som vi stille og roligt tilføjer ting til.

det er indtil #65 i kilden. Og så er vi 
dels ved at være der, dels til at dykke
ned i resten af dem.

EKSEMPEL PÅ STRUKTUREN

The simplest ggplot follows this structure:

ggplot(data = <DATA>, mapping = aes(<MAPPINGS>)) +  <GEOM_FUNCTION>()

We begin by binding a specific data frame to our plot:

~~~
ggplot(data = diamonds)
~~~
{: .language-r}

Then we define an aesthetic mapping of the data, to elements in the plot. We use the helper function aes() for this:


~~~
ggplot(data = diamonds, mapping = aes(x = carat, y = price))
~~~
{: .language-r}

Here we map the weight of the diamonds to the x-axis, and the price to the y-axis. We can map other variables to other elements of the plot, size, shape or color to mention the three most popular.

This in it self does not return a very interesting plot:

~~~
ggplot(data = diamonds, mapping = aes(x = carat, y = price))
~~~
{: .language-r}



~~~
Error in ggplot(data = diamonds, mapping = aes(x = carat, y = price)): could not find function "ggplot"
~~~
{: .error}

We do get the two scales scaled to the ranges of data we have on the x and y axes.


~~~
range(diamonds$carat)
~~~
{: .language-r}



~~~
Error in eval(expr, envir, enclos): object 'diamonds' not found
~~~
{: .error}

~~~
range(diamonds$price)
~~~
{: .language-r}



~~~
Error in eval(expr, envir, enclos): object 'diamonds' not found
~~~
{: .error}
But we have not specified how we want the data plotted.

We add "geoms", the graphical representation of the data in the plot. ggplot2 have a lot of geoms to choose from. We are beginning with these:

- geom_point() makes scatter plots, dot plots etc
- geom_boxplot() makes boxplots
- geom_line() for trendlines, etc

The general naming is relatively intuitive. If geom_histogram makes histograms to take just one example.

Let us make a scatter plot:

~~~
ggplot(data = diamonds, mapping = aes(x = carat, y = price)) +
  geom_point()
~~~
{: .language-r}



~~~
Error in ggplot(data = diamonds, mapping = aes(x = carat, y = price)): could not find function "ggplot"
~~~
{: .error}

Note that we add geoms to our original (boring) plot by using the + operator.

CHALLENGE

Try to plot the price as a function of the table variable, instead of the carat:

SOLUTION

~~~
ggplot(diamonds, aes(x, price)) + geom_point()
~~~
{: .language-r}



~~~
Error in ggplot(diamonds, aes(x, price)): could not find function "ggplot"
~~~
{: .error}

The + operator is rather useful, because it allows us to modify existing plots. We can save the very first plot we made in a variable:

~~~
diamond_plot <- ggplot(data = diamonds, mapping = aes(x = carat, y = price))
~~~
{: .language-r}



~~~
Error in ggplot(data = diamonds, mapping = aes(x = carat, y = price)): could not find function "ggplot"
~~~
{: .error}

And then make the scatter plot by adding the relevant geom to it:


~~~
diamond_plot + geom_point()
~~~
{: .language-r}



~~~
Error in eval(expr, envir, enclos): object 'diamond_plot' not found
~~~
{: .error}
Anything you put in the ggplot() function can be seen by any geom layers that you add (i.e., these are universal plot settings). This includes the x- and y-axis you set up in aes().
You can also specify aesthetics for a given geom independently of the aesthetics defined globally in the ggplot() function.
The + sign used to add layers must be placed at the end of each line containing a layer. If, instead, the + sign is added in the line before the other layer, ggplot2 will not add the new layer and will return an error message.
You may notice that we sometimes reference ‘ggplot2’ and sometimes ‘ggplot’. To clarify, ‘ggplot2’ is the name of the most recent version of the package. However, any time we call the function itself, it’s just called ‘ggplot’.


# This is the correct syntax for adding layers
surveys_plot +
  geom_point()

# This will not add the new layer and will return an error message
surveys_plot
  + geom_point()


saving plottet.

{% include links.md %}
